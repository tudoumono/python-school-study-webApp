# PyPuzzle バックログ

## 実施済み（2026-02-09）

- [x] Google Sheets から問題データ取得（API Route + 5分キャッシュ）
- [x] 問題一覧ページ（`/problems`）
- [x] パンくずリスト統一
- [x] APIレスポンスのエンベロープ形式統一（`{ data, source, error? }`）
- [x] トップ画面のデータソース表示（モック/エラー判別）
- [x] カテゴリをスプレッドシートで管理（`categories` シート + `/api/categories`）
- [x] 問題追加スキル（`add-problem` + `add-category`）
- [x] スプレッドシート初期セットアップスクリプト（`setup-sheet.mjs`）
- [x] 学習ログのスプレッドシート追記（`attempt_logs` + `/api/learning-events`）
- [x] 集計シート自動生成（`daily_stats`, `student_stats`, `category_stats` QUERY式）
- [x] モノレポ構成（`apps/web/` + `amplify/`）
- [x] Amplify Gen 2 バックエンド定義（Auth/Data スキーマ）
- [x] Amplify SSR 環境変数修正（`.env.production` 生成 + mock判定のランタイム化）

## 直近の改善（優先度: 高）

### Amplify 環境での Google Sheets 接続確認
- `.env.production` 生成対応済み（`amplify.yml` preBuild）
- デプロイ後に `/api/problems?refresh=true` で `"source":"sheets"` を確認すること
- 環境変数（`GOOGLE_SERVICE_ACCOUNT_KEY`）の改行処理に注意

### カテゴリアイコンの動的レンダリング
- `CategoryCard.tsx` の `iconMap` が5アイコンしか定義されていない
- スプレッドシートで新カテゴリを追加しても、アイコンが `Box`（デフォルト）にフォールバック
- lucide-react の動的インポートまたは iconMap の拡張が必要

### 問題数の拡充
- 現在カテゴリあたり4問（合計20問）しかない
- 学習効果を出すには各カテゴリ10問以上が望ましい
- `add-problem` スキルを活用してスプレッドシートに追加

## 問題形式の拡張

### エラー修正問題モード
- よくあるPythonエラー（SyntaxError, IndentationError, NameError等）を含むコードを提示し、バグを見つけて直す問題形式
- 既存のD&D並べ替えとは異なる新しい問題タイプ（例: 間違った行をタップ → 正しいブロックに差し替え）
- 実践的なデバッグスキルの養成に有効

### 出力予測問題
- コードを見て「実行結果は？」を選択肢から選ぶ
- コードを読む力がつく

### 穴埋め問題
- コードの一部が `___` で、正しいトークンを選んで埋める
- 並べ替えより難度を下げられる入門向け

### エラーメッセージ読解
- `NameError: name 'prnt' is not defined` を見せて「どこが間違い？」を答える
- エラーメッセージに慣れる訓練

### コード写経モード
- 正解コードをタイピングで入力。手を動かして覚える

## 学習効果・カリキュラム

### Python基礎概念の段階的導入
- インデント: Pythonではインデントが文法であることを学ぶ専用カテゴリ（if/for内のインデント、ネスト）
- import: `import math`、`from random import randint` 等の基本的な使い方を学ぶカテゴリ
- 初学者がいきなり出てくると混乱する概念を、専用の導入問題で段階的に慣れさせる
- 既存カテゴリの前提知識として位置づけ、カテゴリ順序に組み込む

### 忘却曲線ベースの復習
- 間隔反復（spaced repetition）で、忘れそうなタイミングで自動復習
- 問題ごとに次回復習日を計算し、復習リストに自動追加

### ステップ実行ビジュアライザ
- 変数の値がどう変わるか1行ずつ追える
- ループ理解に効果的

## データ・分析

### ユーザー進捗のクラウド管理（Cognito + Googleスプレッドシート）
- 現在localStorageに保存されている学習進捗（ポイント、回答履歴、ストリーク、アナリティクス）をクラウドに移行
- Cognito認証でユーザーを識別し、ユーザーごとの進捗をGoogleスプレッドシートに読み書き
- DynamoDBではなくスプレッドシートで管理する方針（先生が直接データを確認・編集しやすい）
- 端末間の同期、ブラウザキャッシュクリアによるデータ喪失防止が目的
- 前提: Cognito認証の導入

### 集団統計ベースの出題
- `student_stats` / `category_stats` のデータを使って、多くの生徒がつまずく問題を優先出題
- 前提: attempt_logs に十分なデータが蓄積されること

### 学習ペース分析
- 予定 vs 実績の可視化（学習計画との差分）
- 学習ペースのトレンドグラフ

## 先生向け機能

### クラス管理ダッシュボード
- 生徒の進捗一覧、つまずきポイントの可視化
- 前提: Cognito認証 + ユーザー進捗クラウド管理

### カスタム問題作成（UI）
- 先生がWebアプリのUI上から問題を追加できるフォーム
- 現在はスプレッドシート直接編集 or `add-problem` スキルで対応可能

## Google Sheets 運用改善

### student_stats の講師別フィルタビュー整備
- 優先度: 高 / 担当: 運用
- `student_stats` シートに講師ごとのフィルタビューを作成
- 目的: 担当生徒だけを素早く確認できるようにする

### category_stats / student_stats の条件付き書式
- 優先度: 中 / 担当: 運用
- 正答率の閾値を設定して色分け（例: 80%以上=緑、60-79%=黄、59%以下=赤）

### 週次レビュー指標の固定化
- 優先度: 高 / 担当: 運用
- 週次で見るKPIを固定（試行数・正答率・平均解答時間）
- `daily_stats` と `category_stats` を使って週次レビューを実施
